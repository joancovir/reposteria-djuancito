<div class="customizer-container">

  <a class="btn-retroceder" (click)="regresar()">
    ← Volver al catálogo
  </a>

  <div class="customizer-header">
    <h2>Personaliza tu torta</h2>
    <div class="step-indicator">
      <div class="step active">1. Personalización</div>
      <div class="step">2. Entrega</div>
      <div class="step">3. Pago</div>
    </div>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="customizer-form">

    <!-- BIZCOCHO -->
    <div class="form-section">
      <h3>Sabor del Bizcocho</h3>
      <p>Elige el sabor base de tu torta</p>

      <div class="options-grid">
        <div class="option-card" 
             *ngFor="let b of bizcochos"
             [class.selected]="form.value.saborBizcocho === b.nombre">
          <input type="radio" 
                 [id]="'bizcocho-' + b.adicionalId"
                 [value]="b.nombre"
                 formControlName="saborBizcocho">
          <label [for]="'bizcocho-' + b.adicionalId" class="option-content">
            <span class="option-name">{{ b.nombre }}</span>
            <span class="option-price">+ S/ {{ b.costoAdicional.toFixed(2) }}</span>
          </label>
        </div>

        <!-- OPCIÓN OTRO BIZCOCHO -->
        <div class="option-card otro-option"
             [class.selected]="form.value.saborBizcocho === null">
          <input type="radio" 
                 id="bizcocho-otro"
                 [value]="null"
                 formControlName="saborBizcocho">
          <label for="bizcocho-otro" class="option-content">
            <span class="option-name">Otro sabor personalizado</span>
            <span class="option-price text-warning">A cotizar</span>
          </label>
        </div>
      </div>

      <!-- Input para OTRO bizcocho -->
      <div class="mt-3" *ngIf="form.value.saborBizcocho === null">
        <input type="text" 
               class="form-control" 
               formControlName="otroBizcocho"
               placeholder="Ej: Bizcocho de maracuyá, café, almendra, naranja..."
               (input)="calcularPrecio()">
      </div>
    </div>

    <!-- RELLENOS -->
    <div class="form-section">
      <h3>Rellenos</h3>
      <p>Puedes elegir varios</p>

      <div class="options-grid">
        <div class="option-card" *ngFor="let r of rellenos">
          <input type="checkbox" 
                 [id]="'relleno-' + r.adicionalId"
                 [value]="r.nombre"
                 (change)="onCheckboxChange($event, 'rellenos')">
          <label [for]="'relleno-' + r.adicionalId" class="option-content">
            <span class="option-name">{{ r.nombre }}</span>
            <span class="option-price">+ S/ {{ r.costoAdicional.toFixed(2) }}</span>
          </label>
        </div>
      </div>

      <div class="mt-4">
        <input type="text" 
               class="form-control" 
               formControlName="otroRelleno"
               placeholder="¿Quieres un relleno especial? Escríbelo aquí..."
               (input)="calcularPrecio()">
      </div>
    </div>

    <!-- TOPPINGS -->
    <div class="form-section">
      <h3>Toppings y decoraciones</h3>

      <div class="options-grid">
        <div class="option-card" *ngFor="let t of toppings">
          <input type="checkbox" 
                 [id]="'topping-' + t.adicionalId"
                 [value]="t.nombre"
                 (change)="onCheckboxChange($event, 'toppings')">
          <label [for]="'topping-' + t.adicionalId" class="option-content">
            <span class="option-name">{{ t.nombre }}</span>
            <span class="option-price">+ S/ {{ t.costoAdicional.toFixed(2) }}</span>
          </label>
        </div>
      </div>

      <div class="mt-4">
        <input type="text" 
               class="form-control" 
               formControlName="otroTopping"
               placeholder="Ej: Macarons, flores comestibles, chocolate derretido..."
               (input)="calcularPrecio()">
      </div>
    </div>

    <!-- EXTRAS / DECORADOS -->
    <div class="form-section">
      <h3>Extras</h3>

      <div class="options-grid">
        <div class="option-card" *ngFor="let d of decorados">
          <input type="checkbox" 
                 [id]="'decorado-' + d.adicionalId"
                 [value]="d.nombre"
                 (change)="onCheckboxChange($event, 'decorados')">
          <label [for]="'decorado-' + d.adicionalId" class="option-content">
            <span class="option-name">{{ d.nombre }}</span>
            <span class="option-price">+ S/ {{ d.costoAdicional.toFixed(2) }}</span>
          </label>
        </div>
      </div>

      <div class="mt-4">
        <input type="text" 
               class="form-control" 
               formControlName="otroDecorado"
               placeholder="Ej: Figura 3D, foto comestible, luces LED, nombre en chocolate..."
               (input)="calcularPrecio()">
      </div>
    </div>

    <!-- MENSAJE -->
    <div class="form-section">
      <h3>Mensaje en la torta (opcional)</h3>
      <textarea class="form-control" 
                rows="3" 
                formControlName="instrucciones"
                placeholder="Ej: Feliz cumpleaños Juanito, Te amo mamá..."></textarea>
    </div>

    <!-- RESUMEN Y BOTÓN -->
    <div class="form-section">
      <div class="resumen-card p-4 border rounded bg-light">
        <h4 class="mb-3">Resumen de tu torta:</h4>

        <div class="d-flex justify-content-between align-items-center">
          <div>
            <strong class="fs-5">Total:</strong>
            <span class="fs-4 fw-bold text-success ms-3" *ngIf="!necesitaCotizacion">
              S/ {{ precioCalculado.toFixed(2) }}
            </span>
            <span class="fs-4 fw-bold text-warning ms-3" *ngIf="necesitaCotizacion">
              A COTIZAR
            </span>
          </div>
        </div>

        <button type="submit" class="btn-submit mt-4">
          Continuar → Entrega
        </button>
      </div>
    </div>

  </form>
</div>