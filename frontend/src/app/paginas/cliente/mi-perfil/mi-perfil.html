<div class="perfil-container">
  
  <h2>Mi Perfil</h2>
  <p>Actualiza tu información personal y de contacto.</p>

  <div *ngIf="isLoading" class="loading">Cargando tus datos...</div>
  <div *ngIf="errorMensajePerfil" class="alert alert-danger">{{ errorMensajePerfil }}</div>

  <form *ngIf="!isLoading && perfilForm" [formGroup]="perfilForm" (ngSubmit)="guardarPerfil()">
    <div class="form-group">
      <label for="nombre">Nombre Completo</label>
      <input type="text" id="nombre" formControlName="nombre" class="form-control">
      <small *ngIf="isControlInvalid(perfilForm, 'nombre') && getControlError(perfilForm, 'nombre', 'required')" class="text-danger">
        El nombre es requerido.
      </small>
    </div>

    <div class="form-group">
      <label for="email">Correo Electrónico</label>
      <input type="email" id="email" formControlName="email" class="form-control">
      <small>El correo electrónico no se puede cambiar.</small>
    </div>

    <div class="form-group">
      <label for="telefono">Teléfono</label>
      <input type="tel" id="telefono" formControlName="telefono" class="form-control">
      <small *ngIf="isControlInvalid(perfilForm, 'telefono') && getControlError(perfilForm, 'telefono', 'pattern')" class="text-danger">
        El teléfono debe tener 9 dígitos numéricos.
      </small>
    </div>

    <div class="form-group">
      <label for="direccion">Dirección</label>
      <input type="text" id="direccion" formControlName="direccion" class="form-control" placeholder="Ej: Av. Principal 123, Dpto. 401">
    </div>

    <button type="submit" class="btn-guardar" [disabled]="perfilForm.invalid || isSavingPerfil">
      {{ isSavingPerfil ? 'Guardando...' : 'Guardar Cambios' }}
    </button>
    <div *ngIf="exitoMensajePerfil" class="alert alert-success mt-3">{{ exitoMensajePerfil }}</div>
  </form>

  <hr class="separator"> <h2>Cambiar Contraseña</h2>
  <p>Establece una nueva contraseña para tu cuenta.</p>

  <form [formGroup]="passwordForm" (ngSubmit)="cambiarPassword()">
    <div class="form-group">
      <label for="passwordActual">Contraseña Actual</label>
      <input type="password" id="passwordActual" formControlName="passwordActual" class="form-control">
      <small *ngIf="isControlInvalid(passwordForm, 'passwordActual') && getControlError(passwordForm, 'passwordActual', 'required')" class="text-danger">
        La contraseña actual es requerida.
      </small>
    </div>

    <div class="form-group">
      <label for="nuevaPassword">Nueva Contraseña</label>
      <input type="password" id="nuevaPassword" formControlName="nuevaPassword" class="form-control">
      <small *ngIf="isControlInvalid(passwordForm, 'nuevaPassword') && getControlError(passwordForm, 'nuevaPassword', 'required')" class="text-danger">
        La nueva contraseña es requerida.
      </small>
      <small *ngIf="isControlInvalid(passwordForm, 'nuevaPassword') && getControlError(passwordForm, 'nuevaPassword', 'minlength')" class="text-danger">
        La contraseña debe tener al menos 6 caracteres.
      </small>
    </div>

    <div class="form-group">
      <label for="confirmarPassword">Confirmar Nueva Contraseña</label>
      <input type="password" id="confirmarPassword" formControlName="confirmarPassword" class="form-control">
      <small *ngIf="isControlInvalid(passwordForm, 'confirmarPassword') && getControlError(passwordForm, 'confirmarPassword', 'required')" class="text-danger">
        Confirma la nueva contraseña.
      </small>
      <small *ngIf="getPasswordFormError('passwordMismatch')" class="text-danger">
        Las contraseñas no coinciden.
      </small>
    </div>

    <button type="submit" class="btn-guardar" [disabled]="passwordForm.invalid || isSavingPassword">
      {{ isSavingPassword ? 'Cambiando...' : 'Cambiar Contraseña' }}
    </button>
    <div *ngIf="errorMensajePassword" class="alert alert-danger mt-3">{{ errorMensajePassword }}</div>
    <div *ngIf="exitoMensajePassword" class="alert alert-success mt-3">{{ exitoMensajePassword }}</div>
  </form>

</div>