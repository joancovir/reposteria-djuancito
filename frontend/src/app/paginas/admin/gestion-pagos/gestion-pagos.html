<div class="gestion-container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary fw-bold">Gestión de Pagos</h2>
    <button class="btn btn-outline-primary" (click)="refrescar()">
      <i class="bi bi-arrow-clockwise"></i> Actualizar
    </button>
  </div>

  <!-- FILTROS -->
  <div class="filtros mb-4 d-flex gap-3 flex-wrap">
    <input type="text" class="form-control" placeholder="Buscar por ID, código, método..."
           [(ngModel)]="buscar" (input)="filtrarYPaginar()" style="width: 350px;">

    <select class="form-select" [(ngModel)]="estadoFiltro" (change)="filtrarYPaginar()" style="width: 220px;">
      <option value="todos">Todos los estados</option>
      <option value="pendiente_validacion">Pendiente</option>
      <option value="validado">Validado</option>
      <option value="rechazado">Rechazado</option>
    </select>
  </div>

  <!-- ESTADO -->
  <div *ngIf="cargando" class="alert alert-info text-center">
    <i class="bi bi-hourglass-split"></i> Cargando pagos...
  </div>

  <!-- TABLA -->
  <div class="table-responsive" *ngIf="!cargando && pagosPaginados.length > 0">
    <table class="table table-hover align-middle">
      <thead class="table-primary">
        <tr>
          <th>ID</th>
          <th>Monto</th>
          <th>Fecha</th>
          <th>Método</th>
          <th>Cod. Operación</th>
          <th>Tipo</th>
          <th>Estado</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of pagosPaginados">
          <td><strong>#{{ p.pagoId }}</strong></td>
          <td class="fw-bold text-success">S/ {{ p.montoAbonado | number:'1.2-2' }}</td>
          <td>{{ p.fechaPago | date:'dd/MM/yyyy HH:mm' }}</td>
          <td>
            <span class="badge bg-info text-dark">{{ p.metodo | uppercase }}</span>
          </td>
          <td>
            <code class="bg-light px-2 py-1 rounded">{{ p.codigoOperacion || '-' }}</code>
          </td>
          <td>
            <span class="badge" [ngClass]="p.tipoPago === 'GARANTIA' ? 'bg-warning' : 'bg-success'">
              {{ p.tipoPago }}
            </span>
          </td>
          <td>
            <span class="badge fs-6" [ngClass]="estadoColor(p.estado)">
              {{ p.estado.replace('_', ' ') | titlecase }}
            </span>
          </td>
          <td class="text-center">
            <button class="btn btn-success btn-sm me-2"
                    (click)="cambiarEstado(p, 'validado')"
                    [disabled]="p.estado === 'validado'"
                    title="Validar pago">
              <i class="bi bi-check-lg"></i> Validar
            </button>
            <button class="btn btn-danger btn-sm"
                    (click)="cambiarEstado(p, 'rechazado')"
                    [disabled]="p.estado === 'rechazado'"
                    title="Rechazar pago">
              <i class="bi bi-x-lg"></i> Rechazar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- PAGINACIÓN -->
  <div class="d-flex justify-content-center align-items-center mt-4" *ngIf="totalPaginas() > 1">
    <button class="btn btn-outline-primary me-3"
            [disabled]="paginaActual === 1"
            (click)="paginaActual = paginaActual - 1">
      Anterior
    </button>
    <span class="fw-bold">Página {{ paginaActual }} de {{ totalPaginas() }}</span>
    <button class="btn btn-outline-primary ms-3"
            [disabled]="paginaActual === totalPaginas()"
            (click)="paginaActual = paginaActual + 1">
      Siguiente
    </button>
  </div>

  <!-- SIN PAGOS -->
  <div *ngIf="!cargando && pagos.length === 0" class="alert alert-info text-center mt-5">
    <i class="bi bi-inbox fs-1"></i>
    <p class="mt-3">No hay pagos registrados aún.</p>
  </div>
</div>
